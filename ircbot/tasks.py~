from celery import task
from irc import client
from mariabot.models import Bot

@task(track_started = True)
def ircbot(bot):
    bot = Bot.objects.get(nick = bot)
    clnt = client.IRC()
    serv = clnt.server()
    serv.connect(bot.server.server, bot.server.port, bot.nick)
    if bot.nick_pass:
        serv.privmsg("nickserv", "identify "+bot.nick_pass)
    for chan in bot.channel_set.all():
        serv.join(chan.name)
